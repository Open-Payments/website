---
description: Message Structure Schema
---

# Schema Definition

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Open Payments Message Schema",
  "description": "Generic message structure for processing financial and non-financial messages in the Open Payments system",
  "type": "object",
  "required": ["id", "payload", "tenant", "origin", "data", "processing"],
  "properties": {
    "id": {
      "type": "integer",
      "description": "Unique identifier for the message, automatically generated by the system."
    },
    "parent_id": {
      "type": ["integer", "null"],
      "description": "Identifier of the parent message, if applicable. Used for message correlation."
    },
    "payload": {
      "type": "object",
      "description": "Contains the original message content, either directly or as a reference to external storage.",
      "required": ["storage"],
      "properties": {
        "storage": {
          "type": "string",
          "enum": ["Inline", "File"],
          "description": "Specifies how the payload is stored: 'Inline' for direct content storage, 'File' for external file reference."
        },
        "content": {
          "oneOf": [
            {
              "type": "array",
              "items": { "type": "integer", "minimum": 0, "maximum": 255 },
              "description": "Binary content of the message when stored inline as a byte array."
            },
            {
              "type": "string",
              "description": "Message content stored as a string."
            },
            {
              "type": "object",
              "description": "Message content stored as a structured object."
            }
          ],
          "description": "The actual message content when stored inline. Can be a byte array, a string, or a structured object."
        },
        "schema": {
          "type": "string",
          "description": "Standard schema used for the message (e.g., 'ISO20022')."
        },
        "format": {
          "type": "string",
          "description": "Format of the message content (e.g., 'XML', 'JSON')."
        },
        "encoding": {
          "type": "string",
          "description": "Character encoding of the content (e.g., 'UTF-8')."
        },
        "size": {
          "type": "integer",
          "description": "Size of the payload in bytes."
        }
      }
    },
    "version": {
      "type": "integer",
      "description": "Version of the message format."
    },
    "tenant": {
      "type": "string",
      "description": "Identifier for the organization or business unit owning this message."
    },
    "origin": {
      "type": "string",
      "description": "Identifier of the source system that generated the message (e.g., 'api', 'batch')."
    },
    "processing": {
      "type": "object",
      "description": "Current processing state and progress information.",
      "required": ["status", "workflow_id"],
      "properties": {
        "status": {
          "type": "string",
          "description": "Current state of message processing.",
          "examples": ["Processing", "Completed", "Failed"]
        },
        "workflow_id": {
          "type": "string",
          "description": "Identifier of the workflow processing this message."
        },
        "prev_task": {
          "type": "string",
          "description": "Identifier of the last successfully completed task."
        },
        "prev_status_code": {
          "type": "string",
          "description": "Status code returned by the last completed task."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the last processing update."
        }
      }
    },
    "data": {
      "type": "object",
      "description": "Domain-specific structured message data.",
      "additionalProperties": true
    },
    "metadata": {
      "type": "object",
      "description": "Additional information about the message that aids in processing.",
      "properties": {
        "customer_risk_score": {
          "type": "integer",
          "description": "Risk score assigned to the customer."
        },
        "customer_category": {
          "type": "string",
          "description": "Customer category classification (e.g., 'LOW', 'MEDIUM', 'HIGH')."
        },
        "exchange_rate": {
          "type": "number",
          "description": "Exchange rate applied to the transaction."
        }
      }
    },
    "audit": {
      "type": "array",
      "description": "Chronological record of all processing tasks.",
      "items": {
        "type": "object",
        "required": ["id", "start_time", "finish_time", "workflow", "task", "description", "changes"],
        "properties": {
          "id": {
            "type": "integer",
            "description": "Unique identifier for the audit log entry."
          },
          "start_time": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the processing task started."
          },
          "finish_time": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the processing task finished."
          },
          "workflow": {
            "type": "string",
            "description": "Workflow associated with the processing step."
          },
          "workflow_version": {
            "type": "integer",
            "description": "Version of the workflow being executed."
          },
          "task": {
            "type": "string",
            "description": "Identifier of the specific processing task."
          },
          "description": {
            "type": "string",
            "description": "Details of the processing task."
          },
          "changes": {
            "type": "array",
            "description": "List of changes made during processing.",
            "items": {
              "type": "object",
              "required": ["field", "reason"],
              "properties": {
                "field": {
                  "type": "string",
                  "description": "JSON path of the changed field."
                },
                "old_value": {
                  "type": ["string", "number", "boolean", "object", "array", "null"],
                  "description": "Previous value before the change."
                },
                "new_value": {
                  "type": ["string", "number", "boolean", "object", "array", "null"],
                  "description": "New value after the change."
                },
                "reason": {
                  "type": "string",
                  "description": "Reason for the change."
                }
              }
            }
          }
        }
      }
    }
  }
}
```
